{% extends "generator/base.html" %}
{% load static %}

{% block javascript %}

<script>
$(function() {
  //TODO: use of ajaxSetup() is not recommended
  $.ajaxSetup({
    headers: { "X-CSRFToken": helpers.getCookie("csrftoken") }
  });
  requests.loadGame({{ game_id }}, function (data) {
    game.load(data);
  });
  helpers.setEventHandlers();
});

$("form#generator").submit(function (e) {
	e.preventDefault();
  var key = $("#generator option:selected").val();
  var text = $("#generator [name='" + key + "']").text();
  var gameID = 69;
  var data = {
    text: text,
    gameID: gameID
  };
  requests.generate(data, function (data) {
    $("#content").html(data.detail);
  });
});

//broken: ajax request will not allow redirect to oauth page
// $("form#sync").submit(function (e) {
//   e.preventDefault();
//   console.log($("#inputSheetURL").val());
//   var sheetURL = $("#inputSheetURL").val();
//   var gameID = 69;
//   var data = {
//     sheetURL: sheetURL,
//     gameID: gameID
//   };
//   requests.syncSheet(data, function (data) {
//     console.log("done");
//     console.log(data);
//   });
// });
</script>
{% endblock %}

{% block content %}

<div class="container">
  <div class="row">
  	<div class="col-md-12 text-center">
  		<h1 id="name-input">[project-name]</h1>
  	</div>

    <div class="col-md-12">

      <canvas id="canvas" width="500" height="500" style="border:1px solid #000000;">
      </canvas>

      <form id="component-form">
        <button id="component-delete">x</button>
        <input id="component-name" type="text" placeholder="(not named)"></input>
        <select id="component-category">
          {% for category, display in categories %}
          <option value="{{ category }}">{{ display }}</option>
          {% endfor %}
        </select>
        <div id="detail-display">
          <textarea>Blah</textarea>
        </div>
        <button id="detail-new">New</button>
      </form>

    </div>

    <div class="col-md-4"></div>

    <div class="col-md-4">
      <div class="text-center"><a href="/deletecreds">Delete Credentials</a></div>

      <form class="form" role="form" id="generator" class="text-center" method="post">
      {% csrf_token %}
        <div class="form-group">
          <label for="endpoint-select">Select Content to Generate:</label>
          <select class="form-control" id="endpoint-select">
            <!-- populated by javascript -->
          </select>
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary btn-block">Submit</button>
        </div>
        <div id="endpoint-data" hidden="true">
          <!-- populated by javascript -->
        </div>
      </form>
      <div class="form-group">
        <textarea class="form-control" rows="10" id="content"></textarea>
      </div>

      <form class="form" role="form" id="sync" class="text-center" method="post" action="/api/sync/">
        {% csrf_token %}
        <div class="form-group">
          <label for="inputSheetURL">Google Sheet URL</label>
          <input class="form-control" type="url" id="inputSheetURL" name="sheet-url" placeholder="game.sheet_url">
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary btn-block">Sync Sheet Data</button>
        </div>
      </form>

    </div>

    <div class="col-md-4"></div>

    <div class="col-md-12 text-center">
      <img src="{% static "generator/img/ruins.png" %}" alt="Ruins"/>
    </div>

  </div> <!-- row -->
</div> <!-- container -->

<script src="{% static "generator/js/helpers.js" %}"></script>
<script src="{% static "generator/js/requests.js" %}"></script>
<script src="{% static "generator/js/mapper.js" %}"></script>
<script src="{% static "generator/js/game.js" %}"></script>
{% endblock %}